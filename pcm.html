<input type="file" id="pcm" /><br>
<p id="status"></p>

<script>
"use strict;"

onload = function() {

  document.getElementById("pcm").onchange = function(e) {

    const file = e.target.files[0];
    const reader = new FileReader(file);

    console.log("file size", file.size);

    // Read WAV header
    var start = 0;
    const headerSize = 44;
    var end = start + headerSize;
    reader.readAsArrayBuffer(file.slice(start, end));
    start += headerSize + 2;

    reader.onload = function(e) {

      const status = document.getElementById("status");

      // Read a block of samples
      reader.onload = function(e) {

        console.log("get samples");
        const samples = new Int16Array(e.target.result);

        for (var i in samples) {

          const s = (16384 + samples[i]);
          status.innerText += i + ": " + s + "\n";
        }
      }

      const block = 64;
      end = start + block;
      reader.readAsArrayBuffer(file.slice(start, end));
      start += block;

      // setTimeout(function(){

      //   status.innerText = new Date();

      //   var start = 0;
      //   var end = start + 44;
      //   reader.readAsArrayBuffer(file.slice(start, end));
      //   start += 44;

      // }, 100);
    }
  }
}
</script>
